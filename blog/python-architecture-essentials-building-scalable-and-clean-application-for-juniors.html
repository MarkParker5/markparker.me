<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Python Architecture Essentials: Building Scalable and Clean Applications for Juniors — Mark Parker</title><meta name="og:title" content="Python Architecture Essentials: Building Scalable and Clean Applications for Juniors — Mark Parker"/><meta name="og:image" content="https://markparker.me/articles/python-architecture-essentials-building-scalable-and-clean-application-for-juniors/meta.jpg"/><meta name="description" content="Dive into the fundamentals of scalable and clean application architecture in Python. Here, we explore essential concepts of OOP, SOLID principles, and Dependency Injection with practical examples of a real application structure."/><meta name="og:description" content="Dive into the fundamentals of scalable and clean application architecture in Python. Here, we explore essential concepts of OOP, SOLID principles, and Dependency Injection with practical examples of a real application structure."/><meta name="keywords" content="python architecture,application structure,clean code in Python,SOLID principles Python,scalable Python applications,project structure,code design patterns,dependency injection,dependency injection python,python code maintainability,object-oriented programming Python,python type annotations,Python application layers,OOP vs procedural Python,python development best practices,python modularity,layered architecture,python dependency management,python,python project structure,service vs provider,clean architecture,software design,coding standards,project organization,interface segregation,single responsibility principle,abstraction,protocol"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://markparker.me/articles/python-architecture-essentials-building-scalable-and-clean-application-for-juniors/meta.jpg"/><meta name="twitter:title" content="Python Architecture Essentials: Building Scalable and Clean Applications for Juniors"/><meta name="twitter:description" content="Dive into the fundamentals of scalable and clean application architecture in Python. Here, we explore essential concepts of OOP, SOLID principles, and Dependency Injection with practical examples of a real application structure."/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/><link rel="stylesheet" href="/highlight/styles/atom-one-light.min.css"/><link rel="stylesheet" href="/highlight/styles/atom-one-dark.min.css" media="(prefers-color-scheme: dark)"/><meta name="next-head-count" content="15"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-MPVB5GN2QR"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-MPVB5GN2QR');
          </script><link rel="icon" type="image/x-icon" href="/favicon.png"/><link rel="preload" href="/_next/static/css/d5d0e4d9d26237aa.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d5d0e4d9d26237aa.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-fd1bc4a65a80e5c8.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-5aae0466a51ee992.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5d27780da2e99e2e.js" defer=""></script><script src="/_next/static/chunks/623-5c77ec4bf18d9b30.js" defer=""></script><script src="/_next/static/chunks/66-925bae36a51a5c74.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-3b63c4068900db03.js" defer=""></script><script src="/_next/static/FVJAkIsvhm9giYGohtyVT/_buildManifest.js" defer=""></script><script src="/_next/static/FVJAkIsvhm9giYGohtyVT/_ssgManifest.js" defer=""></script></head><body class="text-primary bg-back dark:text-primary-dark dark:bg-back-dark"><div id="__next"><div class="mx-auto" style="max-width:90%;width:44rem"><header><a class="" href="/"><h1 class="text-center block mt-4 mb-1 text-4xl">Mark Parker</h1></a><div class="text-center"><a class="text-link1 hover:text-link1hover underline hover:no-underline" href="/">About</a> · <a class="text-link1 hover:text-link1hover underline hover:no-underline" href="/blog">Blog</a></div></header><hr class="mx-auto w-3/4 h-1px border-t-1 border-faded my-10"/><main><a style="position:fixed;top:0;left:80%;width:50px" target="_blank" rel="noreferrer noopener" href="https://twitter.com/intent/tweet?text=Python+Architecture+Essentials%3A+Building+Scalable+and+Clean+Applications+for+Juniors&amp;url=https%3A%2F%2Fmarkparker.me%2Fblog%2Fpython-architecture-essentials-building-scalable-and-clean-application-for-juniors&amp;via=MarkParker_5"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 455.731 455.731" xml:space="preserve"> <g> <rect x="0" y="0" style="fill:#333" width="455.731" height="455.731"></rect> <path style="fill:#FFFFFF" d="M60.377,337.822c30.33,19.236,66.308,30.368,104.875,30.368c108.349,0,196.18-87.841,196.18-196.18 c0-2.705-0.057-5.39-0.161-8.067c3.919-3.084,28.157-22.511,34.098-35c0,0-19.683,8.18-38.947,10.107 c-0.038,0-0.085,0.009-0.123,0.009c0,0,0.038-0.019,0.104-0.066c1.775-1.186,26.591-18.079,29.951-38.207 c0,0-13.922,7.431-33.415,13.932c-3.227,1.072-6.605,2.126-10.088,3.103c-12.565-13.41-30.425-21.78-50.25-21.78 c-38.027,0-68.841,30.805-68.841,68.803c0,5.362,0.617,10.581,1.784,15.592c-5.314-0.218-86.237-4.755-141.289-71.423 c0,0-32.902,44.917,19.607,91.105c0,0-15.962-0.636-29.733-8.864c0,0-5.058,54.416,54.407,68.329c0,0-11.701,4.432-30.368,1.272 c0,0,10.439,43.968,63.271,48.077c0,0-41.777,37.74-101.081,28.885L60.377,337.822z"></path> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> </svg></a><a class="text-link1 hover:text-link1hover underline hover:no-underline" href="/">&lt;-<!-- --> Back to home</a><div class="mt-5 mb-3"><p class="mb-2">Read on:</p><div class="inline-flex gap-5 items-center flex-wrap"><a href="https://markparker5.medium.com/python-architecture-essentials-building-scalable-and-clean-application-for-juniors-41d59c29557c" title="Medium" class="" target="_blank"><i class="fab fa-medium fa-xl"></i></a><a href="https://markparker5.hashnode.dev/python-architecture-essentials-building-scalable-and-clean-application-for-juniors" title="Hashnode" class="" target="_blank"><i class="fab fa-hashnode fa-xl"></i></a><a href="https://dev.to/markparker5/python-architecture-essentials-building-scalable-and-clean-application-for-juniors-2o14" title="Dev.to" class="" target="_blank"><i class="fab fa-dev fa-xl"></i></a></div></div><div class="mb-3 mt-1"><h1 class="text-3xl leading-tight font-bold">Python Architecture Essentials: Building Scalable and Clean Applications for Juniors</h1><div class="italic mt-1 text-md opacity-50">Published on <!-- -->May 18th, 2024<!-- --> · <!-- -->20 min<!-- --> read</div></div><div class="markdown mb-10"><p>When it comes to creating scalable and maintainable Python applications, understanding essential concepts such as clean code principles, architectural patterns, and SOLID design practices is crucial. By exploring these principles, beginners will gain insights into building robust, flexible, and easily testable applications, ensuring that their codebase remains clear and maintainable as their projects grow.</p>
<h2>Some Clean Code Theory</h2>
<p>Before diving into architecture, I would like to answer a few frequently asked questions:</p>
<ul>
<li>What are the benefits of specifying types in Python?</li>
<li>What are the reasons for splitting an app into layers?</li>
<li>What are the advantages of using OOP?</li>
<li>What are the drawbacks of using global variables or singletons?</li>
</ul>
<p>Feel free to skip the theory sections if you already know the answers and jump directly to the &quot;Building the App&quot; section.</p>
<h3>Always Annotate Types</h3>
<p>Annotating all types in Python significantly enhances your code by increasing its clarity, robustness, and maintainability:</p>
<ol>
<li>
<p><strong>Type Safety</strong>: Type annotations help catch type mismatches early, reducing bugs and ensuring your code behaves as expected.</p>
</li>
<li>
<p><strong>Self-documenting Code</strong>: Type hints increase the readability of your code and act as built-in documentation, clarifying the expected input and output data types of functions.</p>
</li>
<li>
<p><strong>Improved Code Quality</strong>: Employing type hints encourages better design and architecture, promoting thoughtful planning and implementation of data structures and interfaces.</p>
</li>
<li>
<p><strong>Enhanced Tool Support</strong>: Tools like <strong>mypy</strong> utilize type annotations for static type checking, identifying potential errors before runtime, thus enhancing the development process.</p>
</li>
<li>
<p><strong>Support from Modern Libraries</strong>: Libraries such as <strong>FastAPI</strong> and <strong>Pydantic</strong> leverage type annotations to provide functionalities like automatic data validation, schema generation, and comprehensive API documentation.</p>
</li>
<li>
<p><strong>Advantages of Typed Dataclasses Over Simple Data Structures</strong>: Typed dataclasses improve readability, structured data handling, and type safety compared to dicts and tuples. They use attributes instead of string keys, which minimizes errors due to typos and improves code autocompletion. Dataclasses also provide clear definitions of data structures, support default values, and simplify code maintenance and debugging.</p>
</li>
</ol>
<h4>Separation of concerns</h4>
<ul>
<li>Each layer focuses on a specific aspect, which simplifies development, debugging and maintenance.</li>
</ul>
<h4>Reusability</h4>
<ul>
<li>Layers can be reused in different parts of the application or in other projects. Code duplication is eliminated.</li>
</ul>
<h4>Scalability</h4>
<ul>
<li>Allows different layers to scale independently of each other depending on needs.</li>
</ul>
<h4>Serviceability</h4>
<ul>
<li>Simplifies maintenance by localizing common functions in separate layers.</li>
</ul>
<h4>Improved collaboration</h4>
<ul>
<li>Teams can work on different layers independently.</li>
</ul>
<h4>Flexibility and adaptability</h4>
<ul>
<li>Changes in technology or design can be implemented in specific layers. Only the affected layers need to be adapted, the others remain unaffected.</li>
</ul>
<h4>Testability</h4>
<ul>
<li>Each layer can be tested independently, simplifying unit testing and debugging.</li>
</ul>
<p>Adopting a layered architecture offers significant advantages in development speed, operational management, and long-term maintenance, making systems more robust, manageable, and adaptable to change.</p>
<h3>Procedural vs OOP</h3>
<p>Using Object-Oriented Programming (OOP) and Dependency Injection (DI) can significantly enhance code quality and maintainability compared to a procedural approach with global variables and functions. Here&#x27;s a simple comparison that demonstrates these advantages:</p>
<h4>Procedural Approach: Global Variables and Functions</h4>
<pre><code class="language-python"># Global configuration
database_config = {
    &#x27;host&#x27;: &#x27;localhost&#x27;,
    &#x27;port&#x27;: 3306,
    &#x27;user&#x27;: &#x27;user&#x27;,
    &#x27;password&#x27;: &#x27;pass&#x27;
}

def connect_to_database():
    print(f&quot;Connecting to database on {database_config[&#x27;host&#x27;]}...&quot;)
    # Assume connection is made
    return &quot;database_connection&quot;

def fetch_user(database_connection, user_id):
    print(f&quot;Fetching user {user_id} using {database_connection}&quot;)
    # Fetch user logic
    return {&#x27;id&#x27;: user_id, &#x27;name&#x27;: &#x27;John Doe&#x27;}

# Usage
db_connection = connect_to_database()
user = fetch_user(db_connection, 1)
</code></pre>
<ul>
<li><strong>Code Duplication</strong>: <code>database_config</code> must be passed around or accessed globally in multiple functions.</li>
<li><strong>Testing Difficulty</strong>: Mocking the database connection or configuration involves manipulating global state, which is error-prone.</li>
<li><strong>Tight Coupling</strong>: Functions directly depend on global state and specific implementations.</li>
</ul>
<h4>OOP + DI Approach</h4>
<pre><code class="language-python">from typing import Dict, Optional
from abc import ABC, abstractmethod

class DatabaseConnection(ABC):
    @abstractmethod
    def connect(self):
        pass

    @abstractmethod
    def fetch_user(self, user_id: int) -&gt; Dict:
        pass

class MySQLConnection(DatabaseConnection):
    def __init__(self, config: Dict[str, str]):
        self.config = config

    def connect(self):
        print(f&quot;Connecting to MySQL database on {self.config[&#x27;host&#x27;]}...&quot;)
        # Assume connection is made

    def fetch_user(self, user_id: int) -&gt; Dict:
        print(f&quot;Fetching user {user_id} from MySQL&quot;)
        return {&#x27;id&#x27;: user_id, &#x27;name&#x27;: &#x27;John Doe&#x27;}

class UserService:
    def __init__(self, db_connection: DatabaseConnection):
        self.db_connection = db_connection

    def get_user(self, user_id: int) -&gt; Dict:
        return self.db_connection.fetch_user(user_id)

# Configuration and DI
config = {
    &#x27;host&#x27;: &#x27;localhost&#x27;,
    &#x27;port&#x27;: 3306,
    &#x27;user&#x27;: &#x27;user&#x27;,
    &#x27;password&#x27;: &#x27;pass&#x27;
}
db = MySQLConnection(config)
db.connect()
user_service = UserService(db)
user = user_service.get_user(1)
</code></pre>
<ul>
<li><strong>Reduced Code Duplication</strong>: The database configuration is encapsulated within the connection object; no need to pass it around.</li>
<li><strong>DI Possibilities</strong>: Easily switch out <code>MySQLConnection</code> with another database connection class without changing <code>UserService</code> code.</li>
<li><strong>Encapsulation and Abstraction</strong>: Implementation details of how users are fetched or how the database is connected are hidden away.</li>
<li><strong>Ease of Mocking and Testing</strong>: <code>UserService</code> can be easily tested by injecting a mock or stub of <code>DatabaseConnection</code>.</li>
<li><strong>Object Lifetime Management</strong>: The lifecycle of database connections can be managed more granularly (e.g., using context managers).</li>
<li><strong>Use of OOP Principles</strong>: Demonstrates inheritance (abstract base class), polymorphism (implementing abstract methods), and protocols (interfaces defined by <code>DatabaseConnection</code>).</li>
</ul>
<p>By structuring the application using OOP and DI, the code becomes more modular, easier to test, and flexible to changes, such as swapping out dependencies or changing configurations.</p>
<h3>Global Constants vs Injected Parameters</h3>
<p>When developing software, the choice between using global constants and employing dependency injection (DI) can significantly impact the flexibility, maintainability, and scalability of applications. This analysis delves into the drawbacks of global constants and contrasts them with the advantages provided by dependency injection.</p>
<h4>Global Constants</h4>
<ol>
<li>
<p><strong>Fixed Configuration</strong>: Global constants are static and cannot dynamically adapt to different environments or requirements without modifying the codebase. This rigidity limits their utility across diverse operational scenarios.</p>
</li>
<li>
<p><strong>Limited Testing Scope</strong>: Testing becomes challenging with global constants as they are not easily overridden. Developers might need to alter the global state or employ complex workarounds to accommodate different test scenarios, thereby increasing the risk of errors.</p>
</li>
<li>
<p><strong>Reduced Modularity</strong>: Relying on global constants decreases modularity since components become dependent on specific values being set globally. This dependence reduces the reusability of components across different projects or contexts.</p>
</li>
<li>
<p><strong>Tight Coupling</strong>: Global constants integrate specific behaviors and configurations directly into the codebase, making it difficult to adapt or evolve the application without extensive modifications.</p>
</li>
<li>
<p><strong>Hidden Dependencies</strong>: Similar to global variables, global constants obscure the dependencies within an application. It becomes unclear which parts of the system rely on these constants, complicating both the understanding and the maintenance of the code.</p>
</li>
<li>
<p><strong>Namespace Pollution and Scalability Challenges</strong>: Global constants can clutter the namespace and complicate the scaling of applications. They promote a design that isn&#x27;t modular, hindering efficient distribution across different processes.</p>
</li>
<li>
<p><strong>Maintenance and Refactoring Difficulties</strong>: Over time, the use of global constants can lead to maintenance challenges. Refactoring such a codebase is risky as changes to the constants might inadvertently affect disparate parts of the application.</p>
</li>
<li>
<p><strong>Module-Level State Duplication</strong>: In Python, module-level code might be executed multiple times if imports occur under different paths (e.g., absolute vs. relative). This can lead to duplication of global instances and hard-to-track maintenance bugs, further complicating the application’s stability and predictability.</p>
</li>
</ol>
<h4>Injected Parameters</h4>
<ol>
<li>
<p><strong>Dynamic Flexibility and Configurability</strong>: Dependency injection allows for the dynamic configuration of components, making applications adaptable to varying conditions without needing code changes.</p>
</li>
<li>
<p><strong>Enhanced Testability</strong>: DI improves testability by enabling the injection of mock objects or alternative configurations during tests, effectively isolating components from external dependencies and ensuring more reliable test outcomes.</p>
</li>
<li>
<p><strong>Increased Modularity and Reusability</strong>: Components become more modular and reusable as they are designed to operate with any injected parameters that conform to expected interfaces. This separation of concerns enhances the portability of components across various parts of an application or even different projects.</p>
</li>
<li>
<p><strong>Loose Coupling</strong>: Injected parameters promote loose coupling by decoupling the system’s logic from its configuration. This approach facilitates easier updates and changes to the application.</p>
</li>
<li>
<p><strong>Explicit Dependency Declaration</strong>: With DI, components clearly declare their dependencies, typically through constructor parameters or setters. This clarity makes the system easier to understand, maintain, and extend.</p>
</li>
<li>
<p><strong>Scalability and Complexity Management</strong>: As applications grow, DI helps manage complexity by localizing concerns and separating configuration from usage, aiding in the effective scaling and maintenance of large systems.</p>
</li>
</ol>
<h2>Building the App</h2>
<p>You can find all examples and more details with comments at the <a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="https://github.com/MarkParker5/python-app-architecture-demo">repo</a></p>
<h3>Starting a new Project</h3>
<p>Just a short check-list:</p>
<h4>1. Project and Dependency Management with Poetry</h4>
<p>Poetry shines not only as a project creation tool but also excels in managing dependencies and virtual environments. Start by setting up your project structure using the following command:</p>
<pre><code class="language-shell">poetry new python-app-architecture-demo
</code></pre>
<p>This command crafts a well-organized directory structure: separate folders for Python code and tests, with a root directory for meta-information like <code>pyproject.toml</code>, lock files, and Git configurations.</p>
<h4>2. Version Control with Git</h4>
<p>Initialize Git in your project directory:</p>
<pre><code class="language-shell">git init
</code></pre>
<p>Add a <code>.gitignore</code> file to exclude unnecessary files from your repository. Use the standard Python <code>.gitignore</code> provided by GitHub, and append any specific exclusions like <code>.DS_Store</code> for macOS:</p>
<pre><code class="language-shell">wget -O .gitignore https://raw.githubusercontent.com/github/gitignore/main/Python.gitignore
</code></pre>
<pre><code class="language-shell">echo .DS_Store &gt;&gt; .gitignore
</code></pre>
<h4>3. Manage Dependencies</h4>
<p>Install your project’s dependencies using Poetry:</p>
<pre><code class="language-shell">poetry add fastapi pytest aiogram
</code></pre>
<p>You can install all dependencies later using:</p>
<pre><code class="language-shell">poetry install
</code></pre>
<p>Refer to the official documentation of each library if you need more specific instructions.</p>
<h4>4. Configuration Files</h4>
<p>Create a <code>config.py</code> file to centralize your application settings—a common and effective approach.</p>
<p>Also, manage environment variables effectively:</p>
<pre><code class="language-shell">touch .env example.env
</code></pre>
<p><code>.env</code> contains sensitive data and should be git-ignored, while <code>example.env</code> holds placeholder or default values and is checked into the repository.</p>
<h4>5. Application Entry Point</h4>
<p>Define the entry point of your application in <code>main.py</code>:</p>
<p><em>python_app_architecture/main.py:</em></p>
<pre><code class="language-python">def run():
    print(&#x27;Hello, World!&#x27;)

if __name__ == &#x27;__main__&#x27;: # to avoid run on import
    run()
</code></pre>
<p>Make your project usable as a library and allow programmatic access by importing the <code>run</code> function in the <code>__init__.py</code>:</p>
<p><em>python_app_architecture/<strong>init</strong>.py</em></p>
<pre><code class="language-python">from .main import run
</code></pre>
<p>Enable direct project execution with Poetry by adding a shortcut in <code>__main__.py</code>. This allows you to use the command <code>poetry run python python_app_architecture</code> instead of the longer <code>poetry run python python_app_architecture/main.py</code>.</p>
<p><em>python_app_architecture/<strong>main</strong>.py:</em></p>
<pre><code class="language-python">from .main import run
run()
</code></pre>
<h3>Defining Directories and Layers</h3>
<blockquote>
<p><strong>Disclaimer</strong>: <br/> <em>Of course, every application is different and their architecture will differ depending on the goals and objectives. I&#x27;m not saying that this is the only correct option, but I think that this one is fairly average and suitable for a big part of projects. Try to focus on main approaches and ideas rather than specific examples.</em></p>
</blockquote>
<p>Now, let&#x27;s setup directories for different layers of the application.</p>
<p>Typically, it&#x27;s wise to version your API (e.g., by creating subdirectories like <code>api/v1</code>), but we&#x27;ll keep things simple for now and omit this step.</p>
<pre><code>.
├── python_app_architecture_demo
│   ├── coordinator.py
│   ├── entities
│   ├── general
│   ├── mappers
│   ├── providers
│   ├── repository
│   │   └── models
│   └── services
│       ├── api_service
│       │   └── api
│       │       ├── dependencies
│       │       ├── endpoints
│       │       └── schemas
│       └── telegram_service
└── tests
</code></pre>
<ul>
<li><strong>The App</strong>
<ul>
<li><strong>Entities</strong> — App-wide data structures. Purely carriers of data with no embedded logic.</li>
<li><strong>General</strong> — The utility belt! A consolidated hub for shared utilities, helpers, and library facades.</li>
<li><strong>Mappers</strong> — Specialists in data translation, converting between data forms like database models to entities or between different data formats. It&#x27;s good practice to encapsulate mappers to its usage boundary instead of making them global. For example, models-entities mapper may be part of the repository module. Another example: schemas-entities mapper must stay inside api service and be its private tool.</li>
<li><strong>Providers</strong> — The backbone of core business logic. Providers implement the main logic of the application but remain agnostic of the interface details, ensuring their operations are abstract and isolated.</li>
<li><strong>Repository</strong> — The librarians. Custodians of data access, abstracting the complexities of data source interactions through models, thus isolating database operations from the broader app.<!-- -->
<ul>
<li><strong>Models</strong> — Definitions of local data structures interacting with the database, distinct and isolated from Entities.</li>
</ul>
</li>
<li><strong>Services</strong> — Each service acts as a (almost) standalone sub-application, orchestrating its specific domain of business logic while delegating foundational tasks to providers. This configuration ensures centralized and uniform application-wide logic<!-- -->
<ul>
<li><strong>API Service</strong> — Manages external communications via HTTP/S, structured around a FastAPI framework.<!-- -->
<ul>
<li><strong>Dependencies</strong> — Essential tools and helpers required by various parts of your API, integrated via FastAPI’s DI system.</li>
<li><strong>Endpoints</strong> — Routes that publicly expose your business logic via HTTP.</li>
<li><strong>Schemas</strong> — Data structure definitions for API inputs and outputs, confined to their service layer to maintain encapsulation.</li>
</ul>
</li>
<li><strong>Telegram Service</strong> — Operates similarly to the API Service, providing functionality via Telegram without replicating the core business logic. This is achieved by calling the same providers that API Service uses, ensuring consistency and reducing code redundancy.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Tests</strong> — Dedicated solely to testing, this directory contains all test code, maintaining a clear separation from application logic.</li>
</ul>
<p>The connection between layers will look something like this:</p>
<div class="undefined flex flex-col items-center justify-center"><a href="/articles/python-architecture-essentials-building-scalable-and-clean-application-for-juniors/uml.webp" target="_blank" rel="noreferrer"><img src="/articles/python-architecture-essentials-building-scalable-and-clean-application-for-juniors/uml.webp" class="w-full"/></a></div>
<p>Note that <em>entities</em> are not active components, but only data structures that are passed between layers:</p>
<div class="undefined flex flex-col items-center justify-center"><a href="/articles/python-architecture-essentials-building-scalable-and-clean-application-for-juniors/uml+entities.webp" target="_blank" rel="noreferrer"><img src="/articles/python-architecture-essentials-building-scalable-and-clean-application-for-juniors/uml+entities.webp" class="w-full"/></a></div>
<p>Keep in mind that layers are not directly connected, but only depend on abstractions. Implementations are passed using dependency injection:</p>
<div class="undefined flex flex-col items-center justify-center"><a href="/articles/python-architecture-essentials-building-scalable-and-clean-application-for-juniors/uml+di.webp" target="_blank" rel="noreferrer"><img src="/articles/python-architecture-essentials-building-scalable-and-clean-application-for-juniors/uml+di.webp" class="w-full"/></a></div>
<p>This flexible structure allows you to easily add functionality, for example, change the database, create a service, or connect a new interface without extra changes or code duplication, because logic of each module is located on its own layer:</p>
<div class="undefined flex flex-col items-center justify-center"><a href="/articles/python-architecture-essentials-building-scalable-and-clean-application-for-juniors/uml+services.webp" target="_blank" rel="noreferrer"><img src="/articles/python-architecture-essentials-building-scalable-and-clean-application-for-juniors/uml+services.webp" class="w-full"/></a></div>
<p>At the same time, all logic of a separate service is encapsulated within it:</p>
<div class="undefined flex flex-col items-center justify-center"><a href="/articles/python-architecture-essentials-building-scalable-and-clean-application-for-juniors/uml-service.webp" target="_blank" rel="noreferrer"><img src="/articles/python-architecture-essentials-building-scalable-and-clean-application-for-juniors/uml-service.webp" class="w-full"/></a></div>
<h3>Exploring the Code</h3>
<h4>Endpoint</h4>
<p>Let&#x27;s start from the endpoint:</p>
<pre><code class="language-python"># api_service/api/endpoints/user.py

from typing import Annotated
from fastapi import APIRouter, Depends, HTTPException, status
from entities.user import UserCreate
from ..dependencies.providers import (
	user_provider, # 1
	UserProvider # 2
)

router = APIRouter()

@router.post(&quot;/register&quot;)
async def register(
    user: UserCreate, # 3
    provider: Annotated[UserProvider, Depends(user_provider)] # 4
):
    provider.create_user(user) # 5
    return {&quot;message&quot;: &quot;User created!&quot;}
</code></pre>
<ol>
<li>Importing dependency injection helper function (we will look at it in a minute)</li>
<li>Importing UserProvider <strong>protocol</strong> for type annotation</li>
<li>Endpoint requires the request&#x27;s body to have <code>UserCreate</code> scheme in json format</li>
<li>The <code>provider</code> parameter in the <code>register</code> function is an instance of implementation of <code>UserProvider</code>, injected by FastAPI using the <code>Depends</code> mechanism.</li>
<li>The <code>create_user</code> method of the <code>UserProvider</code> is called with the parsed user data. This demonstrates a clear separation of concerns, where the API layer delegates business logic to the provider layer, adhering to the principle that interface layers should not contain business logic.</li>
</ol>
<h4>UserProvider</h4>
<p>Now, let&#x27;s see the business logic:</p>
<pre><code class="language-python"># providers/user_provider.py

from typing import Protocol, runtime_checkable, Callable
from typing_extensions import runtime_checkable
from repository import UserRepository
from providers.mail_provider import MailProvider
from entities.user import UserCreate


@runtime_checkable
class UserProvider(Protocol): # 1
    def create_user(self, user: UserCreate): ...

@runtime_checkable
class UserProviderOutput(Protocol): # 2
    def user_provider_created_user(self, provider: UserProvider, user: UserCreate): ...

class UserProviderImpl: # 3

    def __init__(self,
        repository: UserRepository,  # 4
        mail_provider: MailProvider, # 4
        output: UserProviderOutput | None, # 5
        on_user_created: Callable[UserCreate], None] | None # 6
    ):
        self.repository = repository
        self.mail_provider = mail_provider
        self.output = output
        self.on_user_created = on_user_created

    # Implementation

    def create_user(self, user: UserCreate): # 7
        self.repository.add_user(user) # 8
        self.mail_provider.send_mail(user.email, f&quot;Welcome, {user.name}!&quot;) # 9

        if output := self.output: # unwraping the optional
            output.user_provider_created_user(self, user) # 10

        # 11
        if on_user_created := self.on_user_created:
            on_user_created(user)

</code></pre>
<ol>
<li>
<p><strong>Defining the Interface</strong>: <code>UserProvider</code> is a protocol that specifies the method <code>create_user</code>, which any class adhering to this protocol must implement. It serves as a formal contract for user creation functionality.</p>
</li>
<li>
<p><strong>Observer Protocol</strong>: <code>UserProviderOutput</code> serves as an observer (or delegate) that is notified when a user is created. This protocol enables loose coupling and enhances the event-driven architecture of the application.</p>
</li>
<li>
<p><strong>Protocol Implementation</strong>: <code>UserProviderImpl</code> implements the user creation logic but does not need to explicitly declare its adherence to <code>UserProvider</code> due to Python&#x27;s dynamic nature and the use of duck typing.</p>
</li>
<li>
<p><strong>Core Dependencies</strong>: The constructor accepts <code>UserRepository</code> and <code>MailProvider</code>—both defined as protocols—as parameters. By relying solely on these protocols, the <code>UserProviderImpl</code> remains decoupled from specific implementations, illustrating the principles of Dependency Injection where the provider is agnostic of the underlying details, interfacing only through defined contracts.</p>
</li>
<li>
<p><strong>Optional Output Delegate</strong>: The constructor accepts an optional <code>UserProviderOutput</code> instance, which, if provided, will be notified upon the completion of user creation.</p>
</li>
<li>
<p><strong>Callback Function</strong>: As an alternative to the output delegate, a callable <code>on_user_created</code> can be passed to handle additional actions post-user creation, providing flexibility in response to events.</p>
</li>
<li>
<p><strong>Central Business Logic</strong>: The <code>create_user</code> method encapsulates the main business logic for adding a user, demonstrating separation from API handling.</p>
</li>
<li>
<p><strong>Repository Interaction</strong>: Utilizes the <code>UserRepository</code> to abstract the database operations (e.g., adding a user), ensuring the provider does not directly manipulate the database.</p>
</li>
<li>
<p><strong>Extended Business Logic</strong>: Involves sending an email through <code>MailProvider</code>, illustrating that the provider&#x27;s responsibilities can extend beyond simple CRUD operations.</p>
</li>
<li>
<p><strong>Event Notification</strong>: If an output delegate is provided, it notifies this delegate about the user creation event, leveraging the observer pattern for enhanced interactivity and modular reactions to events.</p>
</li>
<li>
<p><strong>Callback Execution</strong>: Optionally executes a callback function, providing a straightforward method to extend functionality without complex class hierarchies or dependencies.</p>
</li>
</ol>
<h4>FastAPI Dependencies</h4>
<p>Ok, but how to instantiate the provider and inject it? Let&#x27;s take a look at the injection code, powered by FastAPI&#x27;s DI engine:</p>
<pre><code class="language-python"># services/api_service/api/dependencies/providers.py
from typing import Annotated
from fastapi import Request, Depends
from repository import UserRepository
from providers.user_provider import UserProvider, UserProviderImpl
from providers.mail_provider import MailProvider
from coordinator import Coordinator
from .database import get_session, Session
import config


def _get_coordinator(request: Request) -&gt; Coordinator:
    # private helper function
    # NOTE: You can pass the DIContainer in the same way
    return request.app.state.coordinator

def user_provider(
    session: Annotated[Session, Depends(get_session)], # 1
    coordinator: Annotated[Coordinator, Depends(_get_coordinator)] # 2
) -&gt; UserProvider: # 3
    # UserProvider&#x27;s lifecycle is bound to short endpoint&#x27;s lifecycle, so it&#x27;s safe to use strong references here
    return UserProviderImpl( # 4
        repository=UserRepository(session), # 5
        mail_provider=MailProvider(config.mail_token), # 6
        output=coordinator, # 7
        on_user_created=coordinator.on_user_created # 8
        # on_user_created: lambda: coordinator.on_user_created() # add a lambda if the method&#x27;s signature is not compatible
    )
</code></pre>
<ol>
<li>
<p>Getting a database session through FastAPI&#x27;s dependency injection system, ensuring that each request has a clean session.</p>
</li>
<li>
<p>Obtaining an instance of <code>Coordinator</code> from the application state, which is responsible for managing broader application-level tasks and acting as an event manager.</p>
</li>
<li>
<p>Note: the function returns protocol but not the exact implementation</p>
</li>
<li>
<p>Constructing an instance of <code>UserProviderImpl</code> by injecting all the necessary dependencies. This demonstrates a practical application of dependency injection to assemble complex objects.</p>
</li>
<li>
<p>Initializing <code>UserRepository</code> with the session obtained from FastAPI&#x27;s DI system. This repository handles all data persistence operations, abstracting the database interactions from the provider.</p>
</li>
<li>
<p>Setting up <code>MailProvider</code> using a configuration token.</p>
</li>
<li>
<p>Injecting <code>Coordinator</code> as the output protocol. This assumes that <code>Coordinator</code> implements the <code>UserProviderOutput</code> protocol, allowing it to receive notifications when a user is created.</p>
</li>
<li>
<p>Assigns a method from <code>Coordinator</code> as a callback to be executed upon user creation. This allows for additional operations or notifications to be triggered as a side effect of the user creation process.</p>
</li>
</ol>
<p>This structured approach ensures that the <code>UserProvider</code> is equipped with all necessary tools to perform its tasks effectively, while adhering to the principles of loose coupling and high cohesion.</p>
<h4>Coordinator</h4>
<p>The Coordinator class acts as the main orchestrator within your application, managing various services, interactions, events, setting the initial state, and injecting dependencies. Here&#x27;s a detailed breakdown of its roles and functionalities based on the provided code:</p>
<pre><code class="language-python"># coordinator.py

from threading import Thread
import weakref
import uvicorn
import config
from services.api_service import get_app as get_fastapi_app
from entities.user import UserCreate
from repository.user_repository import UserRepository
from providers.mail_provider import MailProvider
from providers.user_provider import UserProvider, UserProviderImpl
from services.report_service import ReportService
from services.telegram_service import TelegramService


class Coordinator:

    def __init__(self):
        self.users_count = 0 # 1

        self.telegram_service = TelegramService( # 2
            token=config.telegram_token,
            get_user_provider=lambda session: UserProviderImpl(
                repository=UserRepository(session),
                mail_provider=MailProvider(config.mail_token),
                output=self,
                on_user_created=self.on_user_created
            )
        )

        self.report_service = ReportService(
            get_users_count = lambda: self.users_count # 3
        )

    # Coordinator&#x27;s Interface

    def setup_initial_state(self):
        fastapi_app = get_fastapi_app()

        fastapi_app.state.coordinator = self # 4

        # 5
        fastapi_thread = Thread(target=lambda: uvicorn.run(fastapi_app))
        fastapi_thread.start()

        # 6
        self.report_service.start()
        self.telegram_service.start()

    # UserProviderOutput Protocol Implementation

    def user_provider_created_user(self, provider: UserProvider, user: UserCreate):
        self.on_user_created(user)

    # Event handlers

    def on_user_created(self, user):
        print(&quot;User created: &quot;, user)
        self.users_count += 1

        # 7
        if self.users_count &gt;= 10_000:
            self.report_service.interval_seconds *= 10
        elif self.users_count &gt;= 10_000_000:
            self.report_service.stop() # 8
</code></pre>
<ol>
<li>Some state can be shared between different providers, services, layers, and the entire app</li>
<li>Assembling implementations and injecting dependencies</li>
<li>Be aware of circular references, deadlocks, and memory leaks here, see <a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="https://github.com/MarkParker5/python-app-architecture-demo">the full code</a> for detatils</li>
<li>Pass the coordinator instance to the FastAPI app state so you can access it in the endpoints via FastAPI&#x27;s DI system</li>
<li>Start all services in separate threads</li>
<li>Already runs in a separate thread inside the service</li>
<li>Some cross-service logic here, just for example</li>
<li>Example of controlling services from the coordinator</li>
</ol>
<p>This orchestrator centralizes control and communication between different components, enhancing manageability and scalability of the application. It effectively coordinates actions across services, ensuring that the application responds appropriately to state changes and user interactions. This design pattern is crucial for maintaining a clean separation of concerns and enabling more robust and flexible application behavior.</p>
<h4>DI Container</h4>
<p>However, in large-scale applications manual DI can lead to a significant amount of boilerplate code. This is when DI Container comes to rescue. DI Containers, or Dependency Injection Containers, are powerful tools used in software development to manage dependencies within an application. They serve as a central location where objects and their dependencies are registered and managed. When an object requires a dependency, the DI Container automatically handles the instantiation and provision of these dependencies, ensuring that objects receive all the necessary components to function effectively. This approach promotes loose coupling, enhances testability, and improves the overall maintainability of the codebase by abstracting the complex logic of dependency management away from the business logic of the application. DI Containers simplify the development process by automating and centralizing the configuration of component dependencies.</p>
<p>For python, there are many libraries providing different DI Container implementations, I looked almost all of them and wrote down the best IMO</p>
<ul>
<li><a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="https://python-dependency-injector.ets-labs.org/introduction/di_in_python.html">python-dependency-injector</a> — automated, class-based, has different lifecycle options like Singleton or Factory</li>
<li><a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="https://lagom-di.readthedocs.io/en/latest/">lagom</a> — a dictionary interface with automatic resolve</li>
<li><a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="https://github.com/reagento/dishka">dishka</a> — good scope control via context manager</li>
<li><a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="https://github.com/modern-python/that-depends">that-depends</a> — support for context managers (objects required to be closed in the end), native fastapi integration</li>
<li><a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="https://github.com/bobthemighty/punq">punq</a> — more classic approach with <code>register</code> and <code>resolve</code> methods</li>
<li><a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="https://github.com/Neoteroi/rodi">rodi</a> — classic, simple, automatic</li>
</ul>
<h4>main.py</h4>
<p>For the end, let&#x27;s update the main.py file:</p>
<pre><code class="language-python"># main.py
from coordinator import Coordinator


def run(): # entry point, no logic here, only run the coordinator
    coordinator = Coordinator()
    coordinator.setup_initial_state()

if __name__ == &#x27;__main__&#x27;:
    run()
</code></pre>
<h2>Conclusion</h2>
<p>To gain a comprehensive understanding of the architectural and implementation strategies discussed, it is beneficial to review all files in the <a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="https://github.com/MarkParker5/python-app-architecture-demo">repository</a>. Despite the limited amount of code, each file is enriched with insightful comments and additional details that offer a deeper understanding of the application’s structure and functionality. Exploring these aspects will enhance your familiarity with the system, ensuring you are well-equipped to adapt or expand the application effectively.</p>
<p>This approach is universally beneficial across various Python applications. It&#x27;s effective for stateless backend servers such as those built with FastAPI, but its advantages are particularly pronounced in no-framework apps and applications that manage state. This includes desktop applications (both GUI and command-line), as well as systems that control physical devices like IoT devices, robotics, drones, and other hardware-centric technologies.</p>
<p>Additionally, I highly recommend reading <em>Clean Code</em> by Robert Martin for further enrichment. You can find a summary and key takeaways <a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="https://gist.github.com/MarkParker5/6f47112b73d695127cdf5447213f3bb4">here</a>. This resource will provide you with foundational principles and practices that are crucial for maintaining high standards in software development.</p></div><hr class="mx-auto w-3/4 h-1px border-t-1 border-faded my-10"/><div class="mt-5 mb-3 text-center"><p class="mb-2">Read, comment, and subscribe on:</p><div class="inline-flex gap-5 items-center flex-wrap"><a href="https://markparker5.medium.com/python-architecture-essentials-building-scalable-and-clean-application-for-juniors-41d59c29557c" title="Medium" class="" target="_blank"><i class="fab fa-medium fa-xl"></i></a><a href="https://markparker5.hashnode.dev/python-architecture-essentials-building-scalable-and-clean-application-for-juniors" title="Hashnode" class="" target="_blank"><i class="fab fa-hashnode fa-xl"></i></a><a href="https://dev.to/markparker5/python-architecture-essentials-building-scalable-and-clean-application-for-juniors-2o14" title="Dev.to" class="" target="_blank"><i class="fab fa-dev fa-xl"></i></a></div></div><hr class="mx-auto w-3/4 h-1px border-t-1 border-faded my-10"/><div><h4 class="text-l mb-4">Other articles:</h4><div class="mx-auto font-serif"><ul><li class="text-xl mb-8 list-none"><a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="/blog/ai-powered-mobile-app-with-backend-in-two-days-tutorial">AI-powered Mobile App with Backend in Two Days (Tutorial)</a><span class="block text-base italic opacity-50">— <!-- -->May 5th, 2024<!-- --> · <!-- -->15 min<!-- --> read</span><span class="block text-base">This article delves into the nuts and bolts of creating a Proof of Concept (PoC) of a mobile app built with SwiftUI framework and a backend using FastAPI. As an extra, I&#x27;ll demonstrate effective architecture patterns for SwiftUI apps, specifically MVVMP combined with SOLID principles and Dependency Injection (DI). For android, the code can be easily translated to Kotlin using Jetpack Compose Framework almost without changes.</span></li><li class="text-xl mb-8 list-none"><a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="/blog/house-md-ai-diagnostician-in-your-phone-passing-the-torch-and-entrusting-a-startup-to-capable-hands">Dr. House — AI Diagnostician in your phone. Passing the Torch and Entrusting a Startup to Capable Hands</a><span class="block text-base italic opacity-50">— <!-- -->May 4th, 2024<!-- --> · <!-- -->4 min<!-- --> read</span><span class="block text-base">This article picks up where the previous one left off, [How We Built an AI Startup in a Weekend Hackathon in Germany], focusing more on the final product rather than the hackathon process itself.</span></li><li class="text-xl mb-8 list-none"><a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="/blog/how-we-built-an-ai-startup-in-a-weekend-hackathon-in-germany">How We Built an AI Startup in a Weekend Hackathon in Germany</a><span class="block text-base italic opacity-50">— <!-- -->May 4th, 2024<!-- --> · <!-- -->9 min<!-- --> read</span><span class="block text-base">Here&#x27;s a rundown of my weekend at a Cologne hackathon, where we aimed to start an AI startup in just two days. We went from pitching ideas on Friday night to demoing a working app by Sunday. It involved coding late into the night, figuring out last-minute tech snags, and even putting together a presentation minutes before our demo. As a bonus, I have highlighted a to-do list of the main points for creating a startup.</span></li></ul></div></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"id":"python-architecture-essentials-building-scalable-and-clean-application-for-juniors","date":"2024-5-18","date_pretty":"May 18th, 2024","read_time":"20 min","title":"Python Architecture Essentials: Building Scalable and Clean Applications for Juniors","description":"Dive into the fundamentals of scalable and clean application architecture in Python. Here, we explore essential concepts of OOP, SOLID principles, and Dependency Injection with practical examples of a real application structure.","keywords":["python architecture","application structure","clean code in Python","SOLID principles Python","scalable Python applications","project structure","code design patterns","dependency injection","dependency injection python","python code maintainability","object-oriented programming Python","python type annotations","Python application layers","OOP vs procedural Python","python development best practices","python modularity","layered architecture","python dependency management","python","python project structure","service vs provider","clean architecture","software design","coding standards","project organization","interface segregation","single responsibility principle","abstraction","protocol"],"tweetId":"","mediumUrl":"https://markparker5.medium.com/python-architecture-essentials-building-scalable-and-clean-application-for-juniors-41d59c29557c","devtoUrl":"https://dev.to/markparker5/python-architecture-essentials-building-scalable-and-clean-application-for-juniors-2o14","hashnodeUrl":"https://markparker5.hashnode.dev/python-architecture-essentials-building-scalable-and-clean-application-for-juniors","habrUrl":"","mirrors":[{"url":"https://markparker5.medium.com/python-architecture-essentials-building-scalable-and-clean-application-for-juniors-41d59c29557c","title":"Medium","icon":"fab fa-medium"},{"url":"https://markparker5.hashnode.dev/python-architecture-essentials-building-scalable-and-clean-application-for-juniors","title":"Hashnode","icon":"fab fa-hashnode"},{"url":"https://dev.to/markparker5/python-architecture-essentials-building-scalable-and-clean-application-for-juniors-2o14","title":"Dev.to","icon":"fab fa-dev"}]},"mdxBody":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    h2: \"h2\",\n    ul: \"ul\",\n    li: \"li\",\n    h3: \"h3\",\n    ol: \"ol\",\n    strong: \"strong\",\n    h4: \"h4\",\n    pre: \"pre\",\n    code: \"code\",\n    a: \"a\",\n    em: \"em\",\n    blockquote: \"blockquote\"\n  }, _provideComponents(), props.components), {Img} = _components;\n  if (!Img) _missingMdxReference(\"Img\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"When it comes to creating scalable and maintainable Python applications, understanding essential concepts such as clean code principles, architectural patterns, and SOLID design practices is crucial. By exploring these principles, beginners will gain insights into building robust, flexible, and easily testable applications, ensuring that their codebase remains clear and maintainable as their projects grow.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Some Clean Code Theory\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Before diving into architecture, I would like to answer a few frequently asked questions:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"What are the benefits of specifying types in Python?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"What are the reasons for splitting an app into layers?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"What are the advantages of using OOP?\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"What are the drawbacks of using global variables or singletons?\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Feel free to skip the theory sections if you already know the answers and jump directly to the \\\"Building the App\\\" section.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Always Annotate Types\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Annotating all types in Python significantly enhances your code by increasing its clarity, robustness, and maintainability:\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Type Safety\"\n          }), \": Type annotations help catch type mismatches early, reducing bugs and ensuring your code behaves as expected.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Self-documenting Code\"\n          }), \": Type hints increase the readability of your code and act as built-in documentation, clarifying the expected input and output data types of functions.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Improved Code Quality\"\n          }), \": Employing type hints encourages better design and architecture, promoting thoughtful planning and implementation of data structures and interfaces.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Enhanced Tool Support\"\n          }), \": Tools like \", _jsx(_components.strong, {\n            children: \"mypy\"\n          }), \" utilize type annotations for static type checking, identifying potential errors before runtime, thus enhancing the development process.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Support from Modern Libraries\"\n          }), \": Libraries such as \", _jsx(_components.strong, {\n            children: \"FastAPI\"\n          }), \" and \", _jsx(_components.strong, {\n            children: \"Pydantic\"\n          }), \" leverage type annotations to provide functionalities like automatic data validation, schema generation, and comprehensive API documentation.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Advantages of Typed Dataclasses Over Simple Data Structures\"\n          }), \": Typed dataclasses improve readability, structured data handling, and type safety compared to dicts and tuples. They use attributes instead of string keys, which minimizes errors due to typos and improves code autocompletion. Dataclasses also provide clear definitions of data structures, support default values, and simplify code maintenance and debugging.\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Separation of concerns\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Each layer focuses on a specific aspect, which simplifies development, debugging and maintenance.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Reusability\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Layers can be reused in different parts of the application or in other projects. Code duplication is eliminated.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Scalability\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Allows different layers to scale independently of each other depending on needs.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Serviceability\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Simplifies maintenance by localizing common functions in separate layers.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Improved collaboration\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Teams can work on different layers independently.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Flexibility and adaptability\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Changes in technology or design can be implemented in specific layers. Only the affected layers need to be adapted, the others remain unaffected.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Testability\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Each layer can be tested independently, simplifying unit testing and debugging.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Adopting a layered architecture offers significant advantages in development speed, operational management, and long-term maintenance, making systems more robust, manageable, and adaptable to change.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Procedural vs OOP\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Using Object-Oriented Programming (OOP) and Dependency Injection (DI) can significantly enhance code quality and maintainability compared to a procedural approach with global variables and functions. Here's a simple comparison that demonstrates these advantages:\"\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Procedural Approach: Global Variables and Functions\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# Global configuration\\ndatabase_config = {\\n    'host': 'localhost',\\n    'port': 3306,\\n    'user': 'user',\\n    'password': 'pass'\\n}\\n\\ndef connect_to_database():\\n    print(f\\\"Connecting to database on {database_config['host']}...\\\")\\n    # Assume connection is made\\n    return \\\"database_connection\\\"\\n\\ndef fetch_user(database_connection, user_id):\\n    print(f\\\"Fetching user {user_id} using {database_connection}\\\")\\n    # Fetch user logic\\n    return {'id': user_id, 'name': 'John Doe'}\\n\\n# Usage\\ndb_connection = connect_to_database()\\nuser = fetch_user(db_connection, 1)\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Code Duplication\"\n        }), \": \", _jsx(_components.code, {\n          children: \"database_config\"\n        }), \" must be passed around or accessed globally in multiple functions.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Testing Difficulty\"\n        }), \": Mocking the database connection or configuration involves manipulating global state, which is error-prone.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Tight Coupling\"\n        }), \": Functions directly depend on global state and specific implementations.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"OOP + DI Approach\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"from typing import Dict, Optional\\nfrom abc import ABC, abstractmethod\\n\\nclass DatabaseConnection(ABC):\\n    @abstractmethod\\n    def connect(self):\\n        pass\\n\\n    @abstractmethod\\n    def fetch_user(self, user_id: int) -\u003e Dict:\\n        pass\\n\\nclass MySQLConnection(DatabaseConnection):\\n    def __init__(self, config: Dict[str, str]):\\n        self.config = config\\n\\n    def connect(self):\\n        print(f\\\"Connecting to MySQL database on {self.config['host']}...\\\")\\n        # Assume connection is made\\n\\n    def fetch_user(self, user_id: int) -\u003e Dict:\\n        print(f\\\"Fetching user {user_id} from MySQL\\\")\\n        return {'id': user_id, 'name': 'John Doe'}\\n\\nclass UserService:\\n    def __init__(self, db_connection: DatabaseConnection):\\n        self.db_connection = db_connection\\n\\n    def get_user(self, user_id: int) -\u003e Dict:\\n        return self.db_connection.fetch_user(user_id)\\n\\n# Configuration and DI\\nconfig = {\\n    'host': 'localhost',\\n    'port': 3306,\\n    'user': 'user',\\n    'password': 'pass'\\n}\\ndb = MySQLConnection(config)\\ndb.connect()\\nuser_service = UserService(db)\\nuser = user_service.get_user(1)\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Reduced Code Duplication\"\n        }), \": The database configuration is encapsulated within the connection object; no need to pass it around.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"DI Possibilities\"\n        }), \": Easily switch out \", _jsx(_components.code, {\n          children: \"MySQLConnection\"\n        }), \" with another database connection class without changing \", _jsx(_components.code, {\n          children: \"UserService\"\n        }), \" code.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Encapsulation and Abstraction\"\n        }), \": Implementation details of how users are fetched or how the database is connected are hidden away.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Ease of Mocking and Testing\"\n        }), \": \", _jsx(_components.code, {\n          children: \"UserService\"\n        }), \" can be easily tested by injecting a mock or stub of \", _jsx(_components.code, {\n          children: \"DatabaseConnection\"\n        }), \".\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Object Lifetime Management\"\n        }), \": The lifecycle of database connections can be managed more granularly (e.g., using context managers).\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Use of OOP Principles\"\n        }), \": Demonstrates inheritance (abstract base class), polymorphism (implementing abstract methods), and protocols (interfaces defined by \", _jsx(_components.code, {\n          children: \"DatabaseConnection\"\n        }), \").\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"By structuring the application using OOP and DI, the code becomes more modular, easier to test, and flexible to changes, such as swapping out dependencies or changing configurations.\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Global Constants vs Injected Parameters\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"When developing software, the choice between using global constants and employing dependency injection (DI) can significantly impact the flexibility, maintainability, and scalability of applications. This analysis delves into the drawbacks of global constants and contrasts them with the advantages provided by dependency injection.\"\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Global Constants\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Fixed Configuration\"\n          }), \": Global constants are static and cannot dynamically adapt to different environments or requirements without modifying the codebase. This rigidity limits their utility across diverse operational scenarios.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Limited Testing Scope\"\n          }), \": Testing becomes challenging with global constants as they are not easily overridden. Developers might need to alter the global state or employ complex workarounds to accommodate different test scenarios, thereby increasing the risk of errors.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Reduced Modularity\"\n          }), \": Relying on global constants decreases modularity since components become dependent on specific values being set globally. This dependence reduces the reusability of components across different projects or contexts.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Tight Coupling\"\n          }), \": Global constants integrate specific behaviors and configurations directly into the codebase, making it difficult to adapt or evolve the application without extensive modifications.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Hidden Dependencies\"\n          }), \": Similar to global variables, global constants obscure the dependencies within an application. It becomes unclear which parts of the system rely on these constants, complicating both the understanding and the maintenance of the code.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Namespace Pollution and Scalability Challenges\"\n          }), \": Global constants can clutter the namespace and complicate the scaling of applications. They promote a design that isn't modular, hindering efficient distribution across different processes.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Maintenance and Refactoring Difficulties\"\n          }), \": Over time, the use of global constants can lead to maintenance challenges. Refactoring such a codebase is risky as changes to the constants might inadvertently affect disparate parts of the application.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Module-Level State Duplication\"\n          }), \": In Python, module-level code might be executed multiple times if imports occur under different paths (e.g., absolute vs. relative). This can lead to duplication of global instances and hard-to-track maintenance bugs, further complicating the application’s stability and predictability.\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Injected Parameters\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Dynamic Flexibility and Configurability\"\n          }), \": Dependency injection allows for the dynamic configuration of components, making applications adaptable to varying conditions without needing code changes.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Enhanced Testability\"\n          }), \": DI improves testability by enabling the injection of mock objects or alternative configurations during tests, effectively isolating components from external dependencies and ensuring more reliable test outcomes.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Increased Modularity and Reusability\"\n          }), \": Components become more modular and reusable as they are designed to operate with any injected parameters that conform to expected interfaces. This separation of concerns enhances the portability of components across various parts of an application or even different projects.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Loose Coupling\"\n          }), \": Injected parameters promote loose coupling by decoupling the system’s logic from its configuration. This approach facilitates easier updates and changes to the application.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Explicit Dependency Declaration\"\n          }), \": With DI, components clearly declare their dependencies, typically through constructor parameters or setters. This clarity makes the system easier to understand, maintain, and extend.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Scalability and Complexity Management\"\n          }), \": As applications grow, DI helps manage complexity by localizing concerns and separating configuration from usage, aiding in the effective scaling and maintenance of large systems.\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Building the App\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"You can find all examples and more details with comments at the \", _jsx(_components.a, {\n        href: \"https://github.com/MarkParker5/python-app-architecture-demo\",\n        children: \"repo\"\n      })]\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Starting a new Project\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Just a short check-list:\"\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"1. Project and Dependency Management with Poetry\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Poetry shines not only as a project creation tool but also excels in managing dependencies and virtual environments. Start by setting up your project structure using the following command:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-shell\",\n        children: \"poetry new python-app-architecture-demo\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This command crafts a well-organized directory structure: separate folders for Python code and tests, with a root directory for meta-information like \", _jsx(_components.code, {\n        children: \"pyproject.toml\"\n      }), \", lock files, and Git configurations.\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"2. Version Control with Git\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Initialize Git in your project directory:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-shell\",\n        children: \"git init\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Add a \", _jsx(_components.code, {\n        children: \".gitignore\"\n      }), \" file to exclude unnecessary files from your repository. Use the standard Python \", _jsx(_components.code, {\n        children: \".gitignore\"\n      }), \" provided by GitHub, and append any specific exclusions like \", _jsx(_components.code, {\n        children: \".DS_Store\"\n      }), \" for macOS:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-shell\",\n        children: \"wget -O .gitignore https://raw.githubusercontent.com/github/gitignore/main/Python.gitignore\\n\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-shell\",\n        children: \"echo .DS_Store \u003e\u003e .gitignore\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"3. Manage Dependencies\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Install your project’s dependencies using Poetry:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-shell\",\n        children: \"poetry add fastapi pytest aiogram\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"You can install all dependencies later using:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-shell\",\n        children: \"poetry install\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Refer to the official documentation of each library if you need more specific instructions.\"\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"4. Configuration Files\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Create a \", _jsx(_components.code, {\n        children: \"config.py\"\n      }), \" file to centralize your application settings—a common and effective approach.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Also, manage environment variables effectively:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-shell\",\n        children: \"touch .env example.env\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.code, {\n        children: \".env\"\n      }), \" contains sensitive data and should be git-ignored, while \", _jsx(_components.code, {\n        children: \"example.env\"\n      }), \" holds placeholder or default values and is checked into the repository.\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"5. Application Entry Point\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Define the entry point of your application in \", _jsx(_components.code, {\n        children: \"main.py\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.em, {\n        children: \"python_app_architecture/main.py:\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"def run():\\n    print('Hello, World!')\\n\\nif __name__ == '__main__': # to avoid run on import\\n    run()\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Make your project usable as a library and allow programmatic access by importing the \", _jsx(_components.code, {\n        children: \"run\"\n      }), \" function in the \", _jsx(_components.code, {\n        children: \"__init__.py\"\n      }), \":\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsxs(_components.em, {\n        children: [\"python_app_architecture/\", _jsx(_components.strong, {\n          children: \"init\"\n        }), \".py\"]\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"from .main import run\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Enable direct project execution with Poetry by adding a shortcut in \", _jsx(_components.code, {\n        children: \"__main__.py\"\n      }), \". This allows you to use the command \", _jsx(_components.code, {\n        children: \"poetry run python python_app_architecture\"\n      }), \" instead of the longer \", _jsx(_components.code, {\n        children: \"poetry run python python_app_architecture/main.py\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsxs(_components.em, {\n        children: [\"python_app_architecture/\", _jsx(_components.strong, {\n          children: \"main\"\n        }), \".py:\"]\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"from .main import run\\nrun()\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Defining Directories and Layers\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsxs(_components.p, {\n        children: [_jsx(_components.strong, {\n          children: \"Disclaimer\"\n        }), \": \", _jsx(\"br\", {}), \" \", _jsx(_components.em, {\n          children: \"Of course, every application is different and their architecture will differ depending on the goals and objectives. I'm not saying that this is the only correct option, but I think that this one is fairly average and suitable for a big part of projects. Try to focus on main approaches and ideas rather than specific examples.\"\n        })]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Now, let's setup directories for different layers of the application.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Typically, it's wise to version your API (e.g., by creating subdirectories like \", _jsx(_components.code, {\n        children: \"api/v1\"\n      }), \"), but we'll keep things simple for now and omit this step.\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        children: \".\\n├── python_app_architecture_demo\\n│   ├── coordinator.py\\n│   ├── entities\\n│   ├── general\\n│   ├── mappers\\n│   ├── providers\\n│   ├── repository\\n│   │   └── models\\n│   └── services\\n│       ├── api_service\\n│       │   └── api\\n│       │       ├── dependencies\\n│       │       ├── endpoints\\n│       │       └── schemas\\n│       └── telegram_service\\n└── tests\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"The App\"\n        }), \"\\n\", _jsxs(_components.ul, {\n          children: [\"\\n\", _jsxs(_components.li, {\n            children: [_jsx(_components.strong, {\n              children: \"Entities\"\n            }), \" — App-wide data structures. Purely carriers of data with no embedded logic.\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [_jsx(_components.strong, {\n              children: \"General\"\n            }), \" — The utility belt! A consolidated hub for shared utilities, helpers, and library facades.\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [_jsx(_components.strong, {\n              children: \"Mappers\"\n            }), \" — Specialists in data translation, converting between data forms like database models to entities or between different data formats. It's good practice to encapsulate mappers to its usage boundary instead of making them global. For example, models-entities mapper may be part of the repository module. Another example: schemas-entities mapper must stay inside api service and be its private tool.\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [_jsx(_components.strong, {\n              children: \"Providers\"\n            }), \" — The backbone of core business logic. Providers implement the main logic of the application but remain agnostic of the interface details, ensuring their operations are abstract and isolated.\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [_jsx(_components.strong, {\n              children: \"Repository\"\n            }), \" — The librarians. Custodians of data access, abstracting the complexities of data source interactions through models, thus isolating database operations from the broader app.\", \"\\n\", _jsxs(_components.ul, {\n              children: [\"\\n\", _jsxs(_components.li, {\n                children: [_jsx(_components.strong, {\n                  children: \"Models\"\n                }), \" — Definitions of local data structures interacting with the database, distinct and isolated from Entities.\"]\n              }), \"\\n\"]\n            }), \"\\n\"]\n          }), \"\\n\", _jsxs(_components.li, {\n            children: [_jsx(_components.strong, {\n              children: \"Services\"\n            }), \" — Each service acts as a (almost) standalone sub-application, orchestrating its specific domain of business logic while delegating foundational tasks to providers. This configuration ensures centralized and uniform application-wide logic\", \"\\n\", _jsxs(_components.ul, {\n              children: [\"\\n\", _jsxs(_components.li, {\n                children: [_jsx(_components.strong, {\n                  children: \"API Service\"\n                }), \" — Manages external communications via HTTP/S, structured around a FastAPI framework.\", \"\\n\", _jsxs(_components.ul, {\n                  children: [\"\\n\", _jsxs(_components.li, {\n                    children: [_jsx(_components.strong, {\n                      children: \"Dependencies\"\n                    }), \" — Essential tools and helpers required by various parts of your API, integrated via FastAPI’s DI system.\"]\n                  }), \"\\n\", _jsxs(_components.li, {\n                    children: [_jsx(_components.strong, {\n                      children: \"Endpoints\"\n                    }), \" — Routes that publicly expose your business logic via HTTP.\"]\n                  }), \"\\n\", _jsxs(_components.li, {\n                    children: [_jsx(_components.strong, {\n                      children: \"Schemas\"\n                    }), \" — Data structure definitions for API inputs and outputs, confined to their service layer to maintain encapsulation.\"]\n                  }), \"\\n\"]\n                }), \"\\n\"]\n              }), \"\\n\", _jsxs(_components.li, {\n                children: [_jsx(_components.strong, {\n                  children: \"Telegram Service\"\n                }), \" — Operates similarly to the API Service, providing functionality via Telegram without replicating the core business logic. This is achieved by calling the same providers that API Service uses, ensuring consistency and reducing code redundancy.\"]\n              }), \"\\n\"]\n            }), \"\\n\"]\n          }), \"\\n\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.strong, {\n          children: \"Tests\"\n        }), \" — Dedicated solely to testing, this directory contains all test code, maintaining a clear separation from application logic.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The connection between layers will look something like this:\"\n    }), \"\\n\", _jsx(Img, {\n      src: \"@uml.webp\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Note that \", _jsx(_components.em, {\n        children: \"entities\"\n      }), \" are not active components, but only data structures that are passed between layers:\"]\n    }), \"\\n\", _jsx(Img, {\n      src: \"@uml+entities.webp\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Keep in mind that layers are not directly connected, but only depend on abstractions. Implementations are passed using dependency injection:\"\n    }), \"\\n\", _jsx(Img, {\n      src: \"@uml+di.webp\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This flexible structure allows you to easily add functionality, for example, change the database, create a service, or connect a new interface without extra changes or code duplication, because logic of each module is located on its own layer:\"\n    }), \"\\n\", _jsx(Img, {\n      src: \"@uml+services.webp\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"At the same time, all logic of a separate service is encapsulated within it:\"\n    }), \"\\n\", _jsx(Img, {\n      src: \"@uml-service.webp\"\n    }), \"\\n\", _jsx(_components.h3, {\n      children: \"Exploring the Code\"\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Endpoint\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Let's start from the endpoint:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# api_service/api/endpoints/user.py\\n\\nfrom typing import Annotated\\nfrom fastapi import APIRouter, Depends, HTTPException, status\\nfrom entities.user import UserCreate\\nfrom ..dependencies.providers import (\\n\\tuser_provider, # 1\\n\\tUserProvider # 2\\n)\\n\\nrouter = APIRouter()\\n\\n@router.post(\\\"/register\\\")\\nasync def register(\\n    user: UserCreate, # 3\\n    provider: Annotated[UserProvider, Depends(user_provider)] # 4\\n):\\n    provider.create_user(user) # 5\\n    return {\\\"message\\\": \\\"User created!\\\"}\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Importing dependency injection helper function (we will look at it in a minute)\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Importing UserProvider \", _jsx(_components.strong, {\n          children: \"protocol\"\n        }), \" for type annotation\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Endpoint requires the request's body to have \", _jsx(_components.code, {\n          children: \"UserCreate\"\n        }), \" scheme in json format\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"The \", _jsx(_components.code, {\n          children: \"provider\"\n        }), \" parameter in the \", _jsx(_components.code, {\n          children: \"register\"\n        }), \" function is an instance of implementation of \", _jsx(_components.code, {\n          children: \"UserProvider\"\n        }), \", injected by FastAPI using the \", _jsx(_components.code, {\n          children: \"Depends\"\n        }), \" mechanism.\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"The \", _jsx(_components.code, {\n          children: \"create_user\"\n        }), \" method of the \", _jsx(_components.code, {\n          children: \"UserProvider\"\n        }), \" is called with the parsed user data. This demonstrates a clear separation of concerns, where the API layer delegates business logic to the provider layer, adhering to the principle that interface layers should not contain business logic.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"UserProvider\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Now, let's see the business logic:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# providers/user_provider.py\\n\\nfrom typing import Protocol, runtime_checkable, Callable\\nfrom typing_extensions import runtime_checkable\\nfrom repository import UserRepository\\nfrom providers.mail_provider import MailProvider\\nfrom entities.user import UserCreate\\n\\n\\n@runtime_checkable\\nclass UserProvider(Protocol): # 1\\n    def create_user(self, user: UserCreate): ...\\n\\n@runtime_checkable\\nclass UserProviderOutput(Protocol): # 2\\n    def user_provider_created_user(self, provider: UserProvider, user: UserCreate): ...\\n\\nclass UserProviderImpl: # 3\\n\\n    def __init__(self,\\n        repository: UserRepository,  # 4\\n        mail_provider: MailProvider, # 4\\n        output: UserProviderOutput | None, # 5\\n        on_user_created: Callable[UserCreate], None] | None # 6\\n    ):\\n        self.repository = repository\\n        self.mail_provider = mail_provider\\n        self.output = output\\n        self.on_user_created = on_user_created\\n\\n    # Implementation\\n\\n    def create_user(self, user: UserCreate): # 7\\n        self.repository.add_user(user) # 8\\n        self.mail_provider.send_mail(user.email, f\\\"Welcome, {user.name}!\\\") # 9\\n\\n        if output := self.output: # unwraping the optional\\n            output.user_provider_created_user(self, user) # 10\\n\\n        # 11\\n        if on_user_created := self.on_user_created:\\n            on_user_created(user)\\n\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Defining the Interface\"\n          }), \": \", _jsx(_components.code, {\n            children: \"UserProvider\"\n          }), \" is a protocol that specifies the method \", _jsx(_components.code, {\n            children: \"create_user\"\n          }), \", which any class adhering to this protocol must implement. It serves as a formal contract for user creation functionality.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Observer Protocol\"\n          }), \": \", _jsx(_components.code, {\n            children: \"UserProviderOutput\"\n          }), \" serves as an observer (or delegate) that is notified when a user is created. This protocol enables loose coupling and enhances the event-driven architecture of the application.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Protocol Implementation\"\n          }), \": \", _jsx(_components.code, {\n            children: \"UserProviderImpl\"\n          }), \" implements the user creation logic but does not need to explicitly declare its adherence to \", _jsx(_components.code, {\n            children: \"UserProvider\"\n          }), \" due to Python's dynamic nature and the use of duck typing.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Core Dependencies\"\n          }), \": The constructor accepts \", _jsx(_components.code, {\n            children: \"UserRepository\"\n          }), \" and \", _jsx(_components.code, {\n            children: \"MailProvider\"\n          }), \"—both defined as protocols—as parameters. By relying solely on these protocols, the \", _jsx(_components.code, {\n            children: \"UserProviderImpl\"\n          }), \" remains decoupled from specific implementations, illustrating the principles of Dependency Injection where the provider is agnostic of the underlying details, interfacing only through defined contracts.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Optional Output Delegate\"\n          }), \": The constructor accepts an optional \", _jsx(_components.code, {\n            children: \"UserProviderOutput\"\n          }), \" instance, which, if provided, will be notified upon the completion of user creation.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Callback Function\"\n          }), \": As an alternative to the output delegate, a callable \", _jsx(_components.code, {\n            children: \"on_user_created\"\n          }), \" can be passed to handle additional actions post-user creation, providing flexibility in response to events.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Central Business Logic\"\n          }), \": The \", _jsx(_components.code, {\n            children: \"create_user\"\n          }), \" method encapsulates the main business logic for adding a user, demonstrating separation from API handling.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Repository Interaction\"\n          }), \": Utilizes the \", _jsx(_components.code, {\n            children: \"UserRepository\"\n          }), \" to abstract the database operations (e.g., adding a user), ensuring the provider does not directly manipulate the database.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Extended Business Logic\"\n          }), \": Involves sending an email through \", _jsx(_components.code, {\n            children: \"MailProvider\"\n          }), \", illustrating that the provider's responsibilities can extend beyond simple CRUD operations.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Event Notification\"\n          }), \": If an output delegate is provided, it notifies this delegate about the user creation event, leveraging the observer pattern for enhanced interactivity and modular reactions to events.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [_jsx(_components.strong, {\n            children: \"Callback Execution\"\n          }), \": Optionally executes a callback function, providing a straightforward method to extend functionality without complex class hierarchies or dependencies.\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"FastAPI Dependencies\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Ok, but how to instantiate the provider and inject it? Let's take a look at the injection code, powered by FastAPI's DI engine:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# services/api_service/api/dependencies/providers.py\\nfrom typing import Annotated\\nfrom fastapi import Request, Depends\\nfrom repository import UserRepository\\nfrom providers.user_provider import UserProvider, UserProviderImpl\\nfrom providers.mail_provider import MailProvider\\nfrom coordinator import Coordinator\\nfrom .database import get_session, Session\\nimport config\\n\\n\\ndef _get_coordinator(request: Request) -\u003e Coordinator:\\n    # private helper function\\n    # NOTE: You can pass the DIContainer in the same way\\n    return request.app.state.coordinator\\n\\ndef user_provider(\\n    session: Annotated[Session, Depends(get_session)], # 1\\n    coordinator: Annotated[Coordinator, Depends(_get_coordinator)] # 2\\n) -\u003e UserProvider: # 3\\n    # UserProvider's lifecycle is bound to short endpoint's lifecycle, so it's safe to use strong references here\\n    return UserProviderImpl( # 4\\n        repository=UserRepository(session), # 5\\n        mail_provider=MailProvider(config.mail_token), # 6\\n        output=coordinator, # 7\\n        on_user_created=coordinator.on_user_created # 8\\n        # on_user_created: lambda: coordinator.on_user_created() # add a lambda if the method's signature is not compatible\\n    )\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"Getting a database session through FastAPI's dependency injection system, ensuring that each request has a clean session.\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [\"Obtaining an instance of \", _jsx(_components.code, {\n            children: \"Coordinator\"\n          }), \" from the application state, which is responsible for managing broader application-level tasks and acting as an event manager.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"Note: the function returns protocol but not the exact implementation\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [\"Constructing an instance of \", _jsx(_components.code, {\n            children: \"UserProviderImpl\"\n          }), \" by injecting all the necessary dependencies. This demonstrates a practical application of dependency injection to assemble complex objects.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [\"Initializing \", _jsx(_components.code, {\n            children: \"UserRepository\"\n          }), \" with the session obtained from FastAPI's DI system. This repository handles all data persistence operations, abstracting the database interactions from the provider.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [\"Setting up \", _jsx(_components.code, {\n            children: \"MailProvider\"\n          }), \" using a configuration token.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [\"Injecting \", _jsx(_components.code, {\n            children: \"Coordinator\"\n          }), \" as the output protocol. This assumes that \", _jsx(_components.code, {\n            children: \"Coordinator\"\n          }), \" implements the \", _jsx(_components.code, {\n            children: \"UserProviderOutput\"\n          }), \" protocol, allowing it to receive notifications when a user is created.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [\"Assigns a method from \", _jsx(_components.code, {\n            children: \"Coordinator\"\n          }), \" as a callback to be executed upon user creation. This allows for additional operations or notifications to be triggered as a side effect of the user creation process.\"]\n        }), \"\\n\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This structured approach ensures that the \", _jsx(_components.code, {\n        children: \"UserProvider\"\n      }), \" is equipped with all necessary tools to perform its tasks effectively, while adhering to the principles of loose coupling and high cohesion.\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"Coordinator\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The Coordinator class acts as the main orchestrator within your application, managing various services, interactions, events, setting the initial state, and injecting dependencies. Here's a detailed breakdown of its roles and functionalities based on the provided code:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# coordinator.py\\n\\nfrom threading import Thread\\nimport weakref\\nimport uvicorn\\nimport config\\nfrom services.api_service import get_app as get_fastapi_app\\nfrom entities.user import UserCreate\\nfrom repository.user_repository import UserRepository\\nfrom providers.mail_provider import MailProvider\\nfrom providers.user_provider import UserProvider, UserProviderImpl\\nfrom services.report_service import ReportService\\nfrom services.telegram_service import TelegramService\\n\\n\\nclass Coordinator:\\n\\n    def __init__(self):\\n        self.users_count = 0 # 1\\n\\n        self.telegram_service = TelegramService( # 2\\n            token=config.telegram_token,\\n            get_user_provider=lambda session: UserProviderImpl(\\n                repository=UserRepository(session),\\n                mail_provider=MailProvider(config.mail_token),\\n                output=self,\\n                on_user_created=self.on_user_created\\n            )\\n        )\\n\\n        self.report_service = ReportService(\\n            get_users_count = lambda: self.users_count # 3\\n        )\\n\\n    # Coordinator's Interface\\n\\n    def setup_initial_state(self):\\n        fastapi_app = get_fastapi_app()\\n\\n        fastapi_app.state.coordinator = self # 4\\n\\n        # 5\\n        fastapi_thread = Thread(target=lambda: uvicorn.run(fastapi_app))\\n        fastapi_thread.start()\\n\\n        # 6\\n        self.report_service.start()\\n        self.telegram_service.start()\\n\\n    # UserProviderOutput Protocol Implementation\\n\\n    def user_provider_created_user(self, provider: UserProvider, user: UserCreate):\\n        self.on_user_created(user)\\n\\n    # Event handlers\\n\\n    def on_user_created(self, user):\\n        print(\\\"User created: \\\", user)\\n        self.users_count += 1\\n\\n        # 7\\n        if self.users_count \u003e= 10_000:\\n            self.report_service.interval_seconds *= 10\\n        elif self.users_count \u003e= 10_000_000:\\n            self.report_service.stop() # 8\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"Some state can be shared between different providers, services, layers, and the entire app\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Assembling implementations and injecting dependencies\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"Be aware of circular references, deadlocks, and memory leaks here, see \", _jsx(_components.a, {\n          href: \"https://github.com/MarkParker5/python-app-architecture-demo\",\n          children: \"the full code\"\n        }), \" for detatils\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Pass the coordinator instance to the FastAPI app state so you can access it in the endpoints via FastAPI's DI system\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Start all services in separate threads\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Already runs in a separate thread inside the service\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Some cross-service logic here, just for example\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Example of controlling services from the coordinator\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This orchestrator centralizes control and communication between different components, enhancing manageability and scalability of the application. It effectively coordinates actions across services, ensuring that the application responds appropriately to state changes and user interactions. This design pattern is crucial for maintaining a clean separation of concerns and enabling more robust and flexible application behavior.\"\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"DI Container\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"However, in large-scale applications manual DI can lead to a significant amount of boilerplate code. This is when DI Container comes to rescue. DI Containers, or Dependency Injection Containers, are powerful tools used in software development to manage dependencies within an application. They serve as a central location where objects and their dependencies are registered and managed. When an object requires a dependency, the DI Container automatically handles the instantiation and provision of these dependencies, ensuring that objects receive all the necessary components to function effectively. This approach promotes loose coupling, enhances testability, and improves the overall maintainability of the codebase by abstracting the complex logic of dependency management away from the business logic of the application. DI Containers simplify the development process by automating and centralizing the configuration of component dependencies.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"For python, there are many libraries providing different DI Container implementations, I looked almost all of them and wrote down the best IMO\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://python-dependency-injector.ets-labs.org/introduction/di_in_python.html\",\n          children: \"python-dependency-injector\"\n        }), \" — automated, class-based, has different lifecycle options like Singleton or Factory\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://lagom-di.readthedocs.io/en/latest/\",\n          children: \"lagom\"\n        }), \" — a dictionary interface with automatic resolve\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://github.com/reagento/dishka\",\n          children: \"dishka\"\n        }), \" — good scope control via context manager\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://github.com/modern-python/that-depends\",\n          children: \"that-depends\"\n        }), \" — support for context managers (objects required to be closed in the end), native fastapi integration\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://github.com/bobthemighty/punq\",\n          children: \"punq\"\n        }), \" — more classic approach with \", _jsx(_components.code, {\n          children: \"register\"\n        }), \" and \", _jsx(_components.code, {\n          children: \"resolve\"\n        }), \" methods\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://github.com/Neoteroi/rodi\",\n          children: \"rodi\"\n        }), \" — classic, simple, automatic\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.h4, {\n      children: \"main.py\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"For the end, let's update the main.py file:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-python\",\n        children: \"# main.py\\nfrom coordinator import Coordinator\\n\\n\\ndef run(): # entry point, no logic here, only run the coordinator\\n    coordinator = Coordinator()\\n    coordinator.setup_initial_state()\\n\\nif __name__ == '__main__':\\n    run()\\n\"\n      })\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Conclusion\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"To gain a comprehensive understanding of the architectural and implementation strategies discussed, it is beneficial to review all files in the \", _jsx(_components.a, {\n        href: \"https://github.com/MarkParker5/python-app-architecture-demo\",\n        children: \"repository\"\n      }), \". Despite the limited amount of code, each file is enriched with insightful comments and additional details that offer a deeper understanding of the application’s structure and functionality. Exploring these aspects will enhance your familiarity with the system, ensuring you are well-equipped to adapt or expand the application effectively.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This approach is universally beneficial across various Python applications. It's effective for stateless backend servers such as those built with FastAPI, but its advantages are particularly pronounced in no-framework apps and applications that manage state. This includes desktop applications (both GUI and command-line), as well as systems that control physical devices like IoT devices, robotics, drones, and other hardware-centric technologies.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Additionally, I highly recommend reading \", _jsx(_components.em, {\n        children: \"Clean Code\"\n      }), \" by Robert Martin for further enrichment. You can find a summary and key takeaways \", _jsx(_components.a, {\n        href: \"https://gist.github.com/MarkParker5/6f47112b73d695127cdf5447213f3bb4\",\n        children: \"here\"\n      }), \". This resource will provide you with foundational principles and practices that are crucial for maintaining high standards in software development.\"]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"python-architecture-essentials-building-scalable-and-clean-application-for-juniors"},"buildId":"FVJAkIsvhm9giYGohtyVT","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>