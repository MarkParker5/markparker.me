<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Building a Smart Home - from Voice Assistant to MajorDom v1.0 — Mark Parker</title><meta name="og:title" content="Building a Smart Home - from Voice Assistant to MajorDom v1.0 — Mark Parker"/><meta name="og:image" content="https://markparker.me/articles/building-a-smart-home-from-voice-assistant-to-major-dom-v-1-0/meta.jpg"/><meta name="description" content="The story of the origin of MajorDom: how I started creating my voice assistant and how it grew into a smart home system."/><meta name="og:description" content="The story of the origin of MajorDom: how I started creating my voice assistant and how it grew into a smart home system."/><meta name="keywords" content="majordom,smarthome,smart home,voice assistant,home automation,smart home system,smart devices,mobile development,backend development,raspberry pi,arduino,nrf24l01"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://markparker.me/articles/building-a-smart-home-from-voice-assistant-to-major-dom-v-1-0/meta.jpg"/><meta name="twitter:title" content="Building a Smart Home - from Voice Assistant to MajorDom v1.0"/><meta name="twitter:description" content="The story of the origin of MajorDom: how I started creating my voice assistant and how it grew into a smart home system."/><link rel="stylesheet" href="/highlight/styles/atom-one-light.min.css"/><link rel="stylesheet" href="/highlight/styles/atom-one-dark.min.css" media="(prefers-color-scheme: dark)"/><meta name="next-head-count" content="14"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-MPVB5GN2QR"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-MPVB5GN2QR');
          </script><link rel="icon" type="image/x-icon" href="/favicon.png"/><link rel="preload" href="/_next/static/css/9da334faf3c4a31b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9da334faf3c4a31b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-fd1bc4a65a80e5c8.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-5aae0466a51ee992.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5d27780da2e99e2e.js" defer=""></script><script src="/_next/static/chunks/403-3a09570af24a91e6.js" defer=""></script><script src="/_next/static/chunks/66-9d8acb749e62959f.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-7579a99ca14176d4.js" defer=""></script><script src="/_next/static/6iGqucTs8pFtse2QlKBFh/_buildManifest.js" defer=""></script><script src="/_next/static/6iGqucTs8pFtse2QlKBFh/_ssgManifest.js" defer=""></script></head><body class="text-primary bg-back dark:text-primary-dark dark:bg-back-dark"><div id="__next"><div class="mx-auto" style="max-width:90%;width:44rem"><header><a class="" href="/"><h1 class="text-center block mt-4 mb-1 text-4xl">Mark Parker</h1></a><div class="text-center"><a class="text-link1 hover:text-link1hover underline hover:no-underline" href="/">About</a> · <a class="text-link1 hover:text-link1hover underline hover:no-underline" href="/blog">Blog</a></div></header><hr class="mx-auto w-3/4 h-1px border-t-1 border-faded my-10"/><main><a style="position:fixed;top:0;left:80%;width:50px" target="_blank" rel="noreferrer noopener" href="https://twitter.com/intent/tweet?text=Building+a+Smart+Home+-+from+Voice+Assistant+to+MajorDom+v1.0&amp;url=https%3A%2F%2Fmarkparker.me%2Fblog%2Fbuilding-a-smart-home-from-voice-assistant-to-major-dom-v-1-0&amp;via=MarkParker_5"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 455.731 455.731" xml:space="preserve"> <g> <rect x="0" y="0" style="fill:#333" width="455.731" height="455.731"></rect> <path style="fill:#FFFFFF" d="M60.377,337.822c30.33,19.236,66.308,30.368,104.875,30.368c108.349,0,196.18-87.841,196.18-196.18 c0-2.705-0.057-5.39-0.161-8.067c3.919-3.084,28.157-22.511,34.098-35c0,0-19.683,8.18-38.947,10.107 c-0.038,0-0.085,0.009-0.123,0.009c0,0,0.038-0.019,0.104-0.066c1.775-1.186,26.591-18.079,29.951-38.207 c0,0-13.922,7.431-33.415,13.932c-3.227,1.072-6.605,2.126-10.088,3.103c-12.565-13.41-30.425-21.78-50.25-21.78 c-38.027,0-68.841,30.805-68.841,68.803c0,5.362,0.617,10.581,1.784,15.592c-5.314-0.218-86.237-4.755-141.289-71.423 c0,0-32.902,44.917,19.607,91.105c0,0-15.962-0.636-29.733-8.864c0,0-5.058,54.416,54.407,68.329c0,0-11.701,4.432-30.368,1.272 c0,0,10.439,43.968,63.271,48.077c0,0-41.777,37.74-101.081,28.885L60.377,337.822z"></path> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> <g> </g> </svg></a><a class="text-link1 hover:text-link1hover underline hover:no-underline" href="/">&lt;-<!-- --> Back to home</a><div class="mb-3 mt-1"><h1 class="text-3xl leading-tight font-bold">Building a Smart Home - from Voice Assistant to MajorDom v1.0</h1><div class="italic mt-1 text-md opacity-50">Published on <!-- -->May 26th, 2023<!-- --> · <!-- -->5 min<!-- --> read</div></div><div class="markdown mb-10"><p>In 2019, I first learned about the possibility of speech recognition and synthesis in Python. Google Assistant, Siri, Cortana, and other assistants were even more limited and helpless than they are now. Adding custom voice commands was out of the question. That&#x27;s when I became inspired to create my own voice assistant that would rival even Tony Stark&#x27;s Jarvis.</p>
<p>While working on the core functionality, I started thinking about where to host this assistant. Keeping a laptop constantly powered on was not an option, and I didn&#x27;t have any other computers available. That&#x27;s when I discovered the Raspberry Pi single-board computers. I wanted my voice assistant to be able to control lights, LED strips, and curtains. Arduino boards were great for handling such tasks. The only thing left was to find a way to send commands to the Raspberry Pi. I didn&#x27;t want to use Wi-Fi or Bluetooth right from the start. I found information online about the nRF24L01 modules, gave them a try, and liked the results.</p>
<p>This system worked quite well, but it had two key drawbacks:</p>
<ul>
<li>The range was limited by the sensitivity of the microphone. With a good microphone, everything worked perfectly within a room, but not beyond.</li>
<li>For each parameter of each device, I had to add identical voice commands that only differed in the address and message. It was inconvenient, but tolerable for the time being.</li>
</ul>
<p>To solve the first issue, I added http interface to the voice assistant using Django, which could accept an audio file or a string. In combination with a Kotlin mobile application, I created a wireless microphone, expanding the range to the router&#x27;s coverage area, meaning from the room to the entire apartment and even slightly beyond. Carrying a phone around the home wasn&#x27;t always convenient, so a few days later, I developed an application for my Wear OS smartwatch, which turned out to be an incredibly handy solution.</p>
<p>However, I desired more – access to my assistant anytime, not just at home. The simplest solution was a using a Telegram bot as the input-output interface. However, I couldn&#x27;t shake the feeling that a bot wasn&#x27;t quite right. I decided to keep it as a temporary solution until I had time to develop something better.</p>
<p>I wanted to be able to use my mobile application to access the assistant remotely. I just needed to find a way to send a request to the local Django server without being on the local network. I was ready to open and forward ports on my router, but my provider didn&#x27;t give me a public IP address. That&#x27;s when I tried ngrok. It worked well at first, but in the free version, the server occasionally crashed and changed its address. I quickly dismissed the VPN tunnel option. The cost of a VPS was equivalent to the ngrok subscription, but the implementation was much more complex.</p>
<p>Then I remembered that I had free hosting for PHP websites on Beget and reinvented Long Polling and queues. The implementation was straightforward: the application sent a request to the hosting server, where the PHP code added the request body (JSON) to the end of an array and wrote it to a local file. The Raspberry Pi at home sent a read request to this file every second, and after reading it, cleared the array. This way, I was able to send commands home from anywhere on the planet! Similarly, I set up receiving responses from the assistant: I duplicated the implementation and reversed the roles. Two files and four endpoints on the free PHP hosting provided me with stable bidirectional communication with my home assistant. Shortly after, I taught the assistant to send me messages on its own, such as the room number of the next class at the beginning of each break. Before I could boast about it in college, someone started spamming me at home. I had to add authentication: the login and password were hardcoded in the application, and the server had a check kind of this:</p>
<pre><code class="language-php">if ($login == &#x27;markparker&#x27; &amp;&amp; $password == &#x27;MyVeryStrongP@ssw0rd!&#x27;) {}; 
</code></pre>
<p>The application&#x27;s repositories were private, and the server had no repository (why have a repository for just one file with less than 100 lines?), so the level of security was more than sufficient.</p>
<p>Shortly after, the system gained its first automatic command trigger. With the help of a small feature in my application, I was able to capture an event every time an alarm went off on my phone. This trigger launched the first full scenario: the curtains opened simultaneously, the assistant announced the time, weather, and class schedule at the college. If the room was still dark, the lamp smoothly turned on. At that moment, I felt like a real Tony Stark.</p>
<p>Then I wanted to add more automatic scenarios using motion sensors, presence detectors, lighting sensors, and so on. At this point, the second drawback I mentioned earlier became more noticeable. There was a lot of code duplication, and working with it became less convenient. The project only had the concept of voice commands; there was no notion of devices and triggers. That&#x27;s when I realized how much my voice assistant had grown: I was already building a full-fledged smart home, not just a question-and-answer assistant.</p>
<p>This realization led me to the decision to separate the voice assistant and make the smart home a standalone project, focusing on device control rather than voice commands. And I decided to do it properly from the start, with a full-fledged server, databases, authentication, and a mobile application. Later, a college professor suggested to use web sockets instead of my php array-to-file workaround. This is how I implement remote control of devices over the Internet.</p>
<p>The overall concept remained unchanged: a hub in the form of a Raspberry Pi single-board computer controls Arduinos via the nRF24L01 radio module. I&#x27;ll explain the architecture in more detail in the next article.</p></div><hr class="mx-auto w-3/4 h-1px border-t-1 border-faded my-10"/><div><div class="text-center mb-10"><a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" target="_blank" rel="noreferrer noopener" href="https://twitter.com/MarkParker_5/status/1661971621274370048">Comment</a> <!-- -->this post on Twitter</div></div><hr class="mx-auto w-3/4 h-1px border-t-1 border-faded my-10"/><div><h4 class="text-l mb-4">Other articles:</h4><div class="mx-auto font-serif"><ul><li class="text-xl mb-8 list-none"><a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="/blog/inside-major-dom-v-1-0-exploring-the-architecture-of-a-new-smart-home-system">Inside MajorDom v1.0: Exploring the Architecture of a New Smart Home System</a><span class="block text-base italic">— <!-- -->June 1st, 2023<!-- --> · <!-- -->3 min<!-- --> read</span><span class="block text-base">Exploring the Architecture of MajorDom v1.0: Dive into the inner workings of MajorDom v1.0. Learn about its core components, fault tolerance and offline capabilities.</span></li><li class="text-xl mb-8 list-none"><a class="text-link2-light hover:text-link2hover-light dark:text-link2-dark dark:hover:text-link2hover-dark font-semibold" href="/blog/localize-ios-app-in-5-minutes">How to Localize All Your iOS Apps into 20 Languages in 5 Minutes</a><span class="block text-base italic">— <!-- -->March 1st, 2023<!-- --> · <!-- -->3 min<!-- --> read</span><span class="block text-base">I created a console tool that automatically finds all .strings files in an xcode project and translates them into all languages.</span></li></ul></div></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"id":"building-a-smart-home-from-voice-assistant-to-major-dom-v-1-0","date":"2023-05-26","date_pretty":"May 26th, 2023","read_time":"5 min","title":"Building a Smart Home - from Voice Assistant to MajorDom v1.0","description":"The story of the origin of MajorDom: how I started creating my voice assistant and how it grew into a smart home system.","keywords":["majordom","smarthome","smart home","voice assistant","home automation","smart home system","smart devices","mobile development","backend development","raspberry pi","arduino","nrf24l01"],"tweetId":"1661971621274370048"},"mdxBody":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    ul: \"ul\",\n    li: \"li\",\n    pre: \"pre\",\n    code: \"code\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"In 2019, I first learned about the possibility of speech recognition and synthesis in Python. Google Assistant, Siri, Cortana, and other assistants were even more limited and helpless than they are now. Adding custom voice commands was out of the question. That's when I became inspired to create my own voice assistant that would rival even Tony Stark's Jarvis.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"While working on the core functionality, I started thinking about where to host this assistant. Keeping a laptop constantly powered on was not an option, and I didn't have any other computers available. That's when I discovered the Raspberry Pi single-board computers. I wanted my voice assistant to be able to control lights, LED strips, and curtains. Arduino boards were great for handling such tasks. The only thing left was to find a way to send commands to the Raspberry Pi. I didn't want to use Wi-Fi or Bluetooth right from the start. I found information online about the nRF24L01 modules, gave them a try, and liked the results.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This system worked quite well, but it had two key drawbacks:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"The range was limited by the sensitivity of the microphone. With a good microphone, everything worked perfectly within a room, but not beyond.\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"For each parameter of each device, I had to add identical voice commands that only differed in the address and message. It was inconvenient, but tolerable for the time being.\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"To solve the first issue, I added http interface to the voice assistant using Django, which could accept an audio file or a string. In combination with a Kotlin mobile application, I created a wireless microphone, expanding the range to the router's coverage area, meaning from the room to the entire apartment and even slightly beyond. Carrying a phone around the home wasn't always convenient, so a few days later, I developed an application for my Wear OS smartwatch, which turned out to be an incredibly handy solution.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"However, I desired more – access to my assistant anytime, not just at home. The simplest solution was a using a Telegram bot as the input-output interface. However, I couldn't shake the feeling that a bot wasn't quite right. I decided to keep it as a temporary solution until I had time to develop something better.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"I wanted to be able to use my mobile application to access the assistant remotely. I just needed to find a way to send a request to the local Django server without being on the local network. I was ready to open and forward ports on my router, but my provider didn't give me a public IP address. That's when I tried ngrok. It worked well at first, but in the free version, the server occasionally crashed and changed its address. I quickly dismissed the VPN tunnel option. The cost of a VPS was equivalent to the ngrok subscription, but the implementation was much more complex.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Then I remembered that I had free hosting for PHP websites on Beget and reinvented Long Polling and queues. The implementation was straightforward: the application sent a request to the hosting server, where the PHP code added the request body (JSON) to the end of an array and wrote it to a local file. The Raspberry Pi at home sent a read request to this file every second, and after reading it, cleared the array. This way, I was able to send commands home from anywhere on the planet! Similarly, I set up receiving responses from the assistant: I duplicated the implementation and reversed the roles. Two files and four endpoints on the free PHP hosting provided me with stable bidirectional communication with my home assistant. Shortly after, I taught the assistant to send me messages on its own, such as the room number of the next class at the beginning of each break. Before I could boast about it in college, someone started spamming me at home. I had to add authentication: the login and password were hardcoded in the application, and the server had a check kind of this:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-php\",\n        children: \"if ($login == 'markparker' \u0026\u0026 $password == 'MyVeryStrongP@ssw0rd!') {}; \\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The application's repositories were private, and the server had no repository (why have a repository for just one file with less than 100 lines?), so the level of security was more than sufficient.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Shortly after, the system gained its first automatic command trigger. With the help of a small feature in my application, I was able to capture an event every time an alarm went off on my phone. This trigger launched the first full scenario: the curtains opened simultaneously, the assistant announced the time, weather, and class schedule at the college. If the room was still dark, the lamp smoothly turned on. At that moment, I felt like a real Tony Stark.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Then I wanted to add more automatic scenarios using motion sensors, presence detectors, lighting sensors, and so on. At this point, the second drawback I mentioned earlier became more noticeable. There was a lot of code duplication, and working with it became less convenient. The project only had the concept of voice commands; there was no notion of devices and triggers. That's when I realized how much my voice assistant had grown: I was already building a full-fledged smart home, not just a question-and-answer assistant.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This realization led me to the decision to separate the voice assistant and make the smart home a standalone project, focusing on device control rather than voice commands. And I decided to do it properly from the start, with a full-fledged server, databases, authentication, and a mobile application. Later, a college professor suggested to use web sockets instead of my php array-to-file workaround. This is how I implement remote control of devices over the Internet.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The overall concept remained unchanged: a hub in the form of a Raspberry Pi single-board computer controls Arduinos via the nRF24L01 radio module. I'll explain the architecture in more detail in the next article.\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"building-a-smart-home-from-voice-assistant-to-major-dom-v-1-0"},"buildId":"6iGqucTs8pFtse2QlKBFh","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>